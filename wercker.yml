box: mcr.microsoft.com/dotnet/sdk:6.0
build:
  steps:    
    # HelloWorld Project
    - script:
        name: change to HelloWorld directory
        code: |
            cd HelloWorld
    # Gets the dependencies
    - script:
        name: restore
        code: |
          dotnet restore
    # Build the project
    - script:
        name: build
        code: |
          dotnet build
    # publish the project
    - script:
        name: publish
        code: |
          dotnet publish -o publish
          cd publish
    #copy binary files
    - script:
        name: copy binary files
        code: |
          cp -r . $WERCKER_OUTPUT_DIR/app
          cd $WERCKER_OUTPUT_DIR/app
    - script:
        name: chmod
        code: |
          chmod +x ./docker_entrypoint.sh
    - script:
        name: copy entrypoint
        code: |
          cp docker_entrypoint.sh $WERCKER_OUTPUT_DIR/app
deploy: 
  steps:
    - internal/docker-push:
        registry: https://registry.hub.docker.com
        username: $USERNAME
        password: $PASSWORD 
        repository: wayfarer830/dotnetlearn
        tag: latest
        cwd: $WERCKER_OUTPUT_DIR/app
        entrypoint: "/pipeline/source/app/docker_entrypoint.sh"